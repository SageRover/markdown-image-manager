# 撤销修复快速指南

## 🚀 快速开始

### 1. 正常撤销流程（3步）

```
1️⃣ 选择工作目录 → 2️⃣ 点击"撤销修复" → 3️⃣ 确认撤销
```

### 2. 详细步骤

#### 步骤1：选择工作目录
- 点击主界面的"选择"按钮
- 选择包含Markdown文件的目录（必须是执行智能修复时使用的同一个目录）

#### 步骤2：点击撤销修复
- 在主界面点击"撤销修复"按钮
- 程序会自动查找最新的智能修复备份

#### 步骤3：确认撤销
- 系统显示确认对话框，包含备份信息
- 点击"是"确认撤销操作

## ❌ 常见错误及解决

### 错误1："请先选择工作目录"
**原因**：没有选择工作目录就直接点击撤销
**解决**：先点击"选择"按钮选择工作目录

### 错误2："没有找到备份目录，无法撤销"
**原因**：
- 还没有执行过智能修复操作
- 备份目录被删除了
- 选择的工作目录不正确

**解决**：
1. 确认是否执行过智能修复
2. 检查工作目录下是否有`.backup`文件夹
3. 确认选择的是正确的工作目录

### 错误3："没有找到智能修复的备份记录"
**原因**：
- 备份目录存在但没有智能修复记录
- 备份记录被删除或损坏

**解决**：
1. 检查`.backup`目录下是否有以`smart_fix_`开头的文件夹
2. 重新执行智能修复创建新的备份

## 🔧 应急撤销方法

如果UI撤销失败，可以使用独立撤销脚本：

### 1. 找到撤销脚本
```
工作目录/.backup/smart_fix_YYYYMMDD_HHMMSS/undo_fixes.py
```

### 2. 运行撤销脚本
```bash
cd 工作目录/.backup/smart_fix_YYYYMMDD_HHMMSS/
python undo_fixes.py
```

## 🛠️ 诊断工具

如果遇到问题，运行诊断脚本：
```bash
python diagnose_backup_issue.py
```

诊断脚本会：
- 检查工作目录和备份目录
- 验证修复记录完整性
- 提供具体的解决建议

## 📋 撤销前检查清单

- [ ] 已选择正确的工作目录
- [ ] 工作目录下存在`.backup`文件夹
- [ ] `.backup`目录下有`smart_fix_`开头的文件夹
- [ ] 备份文件夹中有`fix_log.json`和`undo_fixes.py`
- [ ] 确认要撤销的是最近一次智能修复

## ⚠️ 重要提醒

1. **撤销会覆盖当前文件**：如果修复后手动修改了文件，撤销会丢失这些修改
2. **只能撤销最近一次**：每次只能撤销最近一次的智能修复操作
3. **备份目录不要删除**：撤销依赖于`.backup`目录中的文件
4. **撤销后重新扫描**：建议撤销后重新扫描文件以更新统计信息

## 🎯 最佳实践

1. **修复前确认**：智能修复前仔细检查要修复的文件列表
2. **及时撤销**：发现问题立即撤销，不要等太久
3. **保留备份**：不要手动删除`.backup`目录
4. **测试小范围**：大批量修复前先在小范围测试
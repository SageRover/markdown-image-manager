# Markdown 图片管家

一个用于管理 Markdown 文件中图片的桌面应用程序，支持图片分析、上传、智能修复等功能。

## 核心功能

- **📊 智能分析** - 扫描 MD 文件和图片，分析引用关系，识别问题
- **☁️ 图床上传** - 通过 PicList 批量上传图片到图床
- **🔄 链接替换** - 本地/远程链接一键互换
- **📥 图片下载** - 自动下载远程图片到本地
- **🔧 智能修复** - 自动修复文件移动导致的路径问题
- **↩️ 一键撤销** - 支持撤销修复操作，自动备份
- **🗑️ 清理工具** - 删除未引用图片，清理冗余文件

## 快速开始

### 环境要求
- Python 3.6+
- tkinter（通常随 Python 安装）

### 安装运行

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 运行程序
python markdown_image_manager.py
```

### PicList 配置（可选）

图床上传功能需要 PicList：
1. 下载 [PicList](https://github.com/Kuingsmile/PicList)
2. 配置图床服务（GitHub、七牛云等）
3. 确保命令行工具可用

## 使用指南

### 基本流程

1. **选择目录** → 2. **扫描分析** → 3. **执行操作**

### 主要功能

**📊 扫描分析**
- 扫描所有 MD 文件和图片
- 分析引用关系，识别问题
- 在"分析结果"查看详情

**🔧 智能修复**
- 自动修复文件移动导致的路径问题
- 三层匹配算法：精确匹配 → 相似度匹配 → URL解码匹配
- 自动备份，支持一键撤销

**☁️ 图床管理**
- 上传本地图片到图床
- 本地/远程链接互换
- 下载远程图片到本地

**🗑️ 清理工具**
- 删除未引用的图片
- 清理已上传的本地文件

### 支持格式

**图片格式**：JPG、PNG、GIF、BMP、WebP、SVG
**语法支持**：`![](path)` 和 `<img src="path">`

## 智能修复详解

### 工作原理

智能修复采用三层匹配算法，自动修复文件移动导致的路径问题：

1. **精确匹配** - 文件名完全相同（高置信度）
2. **相似度匹配** - 多个同名文件时选择最相似路径（中等置信度）
3. **URL解码匹配** - 处理中文等编码路径（动态置信度）

### 使用场景

- 文件夹重组：`./images/` → `./assets/images/`
- 批量移动：`./old_pics/` → `./new_gallery/`
- 项目重构：路径结构完全改变
- 编码问题：`%E5%9B%BE%E7%89%87.jpg` → `图片.jpg`

### 安全机制

- 严格阈值控制（文件名相似度≥95%，综合相似度≥90%）
- 自动备份原始文件
- 详细操作记录
- 支持一键撤销

## 撤销修复

### 备份结构
```
.backup/smart_fix_YYYYMMDD_HHMMSS/
├── fix_log.json          # 操作记录
├── undo_fixes.py         # 撤销脚本
└── *.backup             # 原始文件备份
```

### 撤销方法

**界面撤销**：选择目录 → 点击"撤销修复" → 确认

**脚本撤销**：
```bash
cd .backup/smart_fix_*/
python undo_fixes.py
```

## 文件说明

**核心文件**
- `markdown_image_manager.py` - 主程序
- `server.js` - Web 服务器
- `gitee_image_fixer.py` - Gitee 图片修复工具
- `image_mapping.json` - 图片映射表（自动生成）

**配置文件**
- `requirements.txt` - Python 依赖
- `package.json` - Node.js 依赖
- `.gitignore` - Git 忽略规则

**启动脚本**
- `start.ps1` / `start.bat` - 启动脚本

**文档**
- `撤销修复快速指南.md` - 撤销功能使用指南

## 常见问题

**PicList 上传失败**
- 检查 PicList 安装和图床配置
- 确认网络连接正常

**图片路径错误**
- 检查 MD 文件中的路径格式
- 确认图片文件存在

**撤销修复失败**
- 确保选择正确的工作目录
- 检查 `.backup` 目录是否完整

**Gitee 图床 403 错误**
- Gitee 对外链有访问限制
- 建议迁移到其他图床（GitHub、七牛云等）

## 技术栈

- **后端**：Python + tkinter
- **前端**：Node.js + Express
- **核心功能**：文件扫描、图片上传、路径处理、智能修复